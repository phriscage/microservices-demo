{{ define "login" }}
  {{ template "header" . }}
    {{ if $.firebase_config}}
      <script type="text/javascript">
        // Initialize Identity Platform Configuration
        // Copy this from Web Setup in the Identity Platform Console
        var config = {
          apiKey: {{ $.firebase_config.ApiKey }},
          authDomain: {{ $.firebase_config.AuthDomain }},
          projectId: {{ $.firebase_config.ProjectId }}
        };
        firebase.initializeApp(config);
      </script>
      <script type="text/javascript">
        // FirebaseUI config.
        var uiConfig = {
          // Modify signInSuccessUrl for your GAE App Config
          signInSuccessUrl: {{ $.firebase_config.SignInSuccessUrl }},
          signInOptions: [
            // Leave the lines as is for the providers you want to offer your users.
            {
              provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,
              authMethod: 'https://accounts.google.com'
            },
            firebase.auth.FacebookAuthProvider.PROVIDER_ID,
            firebase.auth.TwitterAuthProvider.PROVIDER_ID,
            firebase.auth.GithubAuthProvider.PROVIDER_ID,
            {
              provider: 'microsoft.com',
              providerName: 'Microsoft',
              buttonColor: '#2F2F2F',
              iconUrl: 'https://docs.microsoft.com/en-us/azure/active-directory/develop/media/howto-add-branding-in-azure-ad-apps/ms-symbollockup_mssymbol_19.png',
              loginHintKey: 'login_hint'
            },
            firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID
          ],
          credentialHelper: firebaseui.auth.CredentialHelper.NONE,
          // tosUrl and privacyPolicyUrl accept either url string or a callback
          // function.
          // Terms of service url/callback.
          tosUrl: 'https://www.google.com',
          // Privacy policy url/callback.
          privacyPolicyUrl: function() {
            window.location.assign('https://www.google.com');
          }
        };

        // Initialize the FirebaseUI Widget using Firebase.
        var ui = new firebaseui.auth.AuthUI(firebase.auth());
        // The start method will wait until the DOM is loaded.
        ui.start('#firebaseui-auth-container', uiConfig);
      </script>
    {{ end }}

    <main role="main">
        <div class="py-5">
            <div class="container bg-light py-1 px-lg-5 py-lg-1">
                <div class="row py-1 my-2">
                   <div class="col-12 col-lg-8 offset-lg-2">
                      <div class="text-center">
                        <h2>Hipster App Login</h2>
                      </div>
                      <hr/>
                      {{ template "alert" . }}
                      <div id="firebaseui-auth-container"></div>
                   </div>
                </div>
            </div>
        </div>
    </main>

    {{ if $.firebase_config}}
      <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                firebase.auth().onAuthStateChanged(function(user) {
                    if (user) {
                        console.error(user);
                    } else {
                        // No user is signed in.
                    };
                });
            } catch (e) {
                // console.error('firebase.auth().onAuthStateChanged: ', e);
                var message = ' Firebase Auth ' + e + ' Try updating the <a href="/config">configuration</a>';
                var content = `
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>Warning!</strong> ` + message + `
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                `;
                document.getElementById('firebaseui-auth-container').innerHTML =content;
            };
            try {
                let app = firebase.app();
                let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
            } catch (e) {
                console.error(e);
                document.getElementById('firebaseui-auth-container').innerHTML = 'Error loading the Identity Platform SDK, check the console.';
            };
        });
      </script>
    {{ end }}

  {{ template "footer" . }}
{{ end }}
